# Docker Compose config placeholder

version: "3.10"

services:
  postgres:
    image: postgres:16
    container_name: quantisti-postgres
    environment:
      - POSTGRES_USER=quantisti
      - POSTGRES_PASSWORD=quantisti
      - POSTGRES_DB=quantisti
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U quantisti"]
      interval: 10s
      timeout: 5s
      retries: 5

  gateway:
    build: ./services/gateway
    environment:
      - PORT=8080
      - FIREBASE_PROJECT_ID=${FIREBASE_PROJECT_ID:-}
      - DATABASE_URL=${DATABASE_URL:-}
    ports:
      - "8080:8080"
    depends_on:
      - market
      - simulator
      - portfolio
      - stats
      - ml
      - explain

  market:
    build: ./services/market
    environment:
      - PORT=8081
      - DATABASE_URL=postgresql://quantisti:quantisti@postgres:5432/quantisti
    ports:
      - "8081:8081"
    depends_on:
      postgres:
        condition: service_healthy

  simulator:
    build: ./services/simulator
    environment:
      - PORT=8082
      - DATABASE_URL=postgresql://quantisti:quantisti@postgres:5432/quantisti
      - MARKET_SERVICE_URL=http://market:8081
    ports:
      - "8082:8082"
    depends_on:
      postgres:
        condition: service_healthy
      market:
        condition: service_started

  portfolio:
    build: ./services/portfolio
    environment:
      - PORT=8083
      - DATABASE_URL=${DATABASE_URL:-}
    ports:
      - "8083:8083"

  stats:
    build: ./services/stats
    environment:
      - PORT=8084
      - DATABASE_URL=${DATABASE_URL:-}
    ports:
      - "8084:8084"

  ml:
    build: ./services/ml
    environment:
      - PORT=8085
      - DATABASE_URL=postgresql://quantisti:quantisti@postgres:5432/quantisti
      - MARKET_SERVICE_URL=http://market:8081
    ports:
      - "8085:8085"
    depends_on:
      postgres:
        condition: service_healthy

  explain:
    build: ./services/explain
    environment:
      - PORT=8086
      - DATABASE_URL=${DATABASE_URL:-}
    ports:
      - "8086:8086"

volumes:
  postgres_data:
